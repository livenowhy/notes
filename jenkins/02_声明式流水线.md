## 声明式流水线

    声明式 Pipleine 是官方推荐的语法，声明式语法更加简洁。
    所有的声明式 Pipeline 都必须包含一个 pipeline 块中，比如:

    pipeline {
        //run
    }
    
    在声明式 Pipeline 中的基本语句和表达式遵循 Groovy 的语法。但是有以下例外：
    流水线顶层必须是一个块，特别是pipeline{}。
    不需要分号作为分割符，是按照行分割的。
    语句块只能由阶段、指令、步骤、赋值语句组成。例如: input 被视为 input()。

## agent 代理

    agent 指定了流水线的执行节点。

    agent { node { label 'labelname' }}
    aget { label ' labelname '}

    参数:
    1. any 在任何可用的节点上执行 pipeline。none 没有指定 agent 的时候默认。
    2. label 在指定标签上的节点上运行Pipeline。 node 允许额外的选项(自定义workspace)。

## post 运行后处理
    
    当流水线完成后根据完成的状态做一些任务。

    post { 
        always { 
            echo 'I will always say Hello again!'
        }

        failure{
            email : xxxx@dxx.com
        }
    }

    常用的状态:

    always:   无论流水线或者阶段的完成状态;
    changed:  只有当流水线或者阶段完成状态与之前不同时;
    failure:  只有当流水线或者阶段状态为"failure"运行;
    success:  只有当流水线或者阶段状态为"success"运行;
    unstable: 只有当流水线或者阶段状态为"unstable"运行; 例如: 测试失败
    aborted:  只有当流水线或者阶段状态为"aborted "运行; 例如: 手动取消

## stages 阶段

    stages 是流水线的整个运行阶段，包含一个或多个 stage , 建议 stages 至少包含一个 stage。

    stages {
        stage('Example') {
            steps {
                echo 'Hello World'
            }
        }
    }

## environment 环境变量
    
    定义流水线环境变量，可以定义在全局变量或者步骤中的局部变量。这取决于 environment 指令在流水线内的位置。

    agent any

    //全局变量
    environment { 
        activeEnv = 'dev'
    }
    stages {
        stage('Example') {

            //局部变量
            environment { 
                AN_ACCESS_KEY = credentials('my-prefined-secret-text') 
            }

            steps {
                sh 'printenv'
            }
        }
    }

## options 运行选项

    定义流水线运行时的配置选项，流水线提供了许多选项, 比如 buildDiscarder, 但也可以由插件提供, 比如 timestamps。

    agent any
    options {
        timeout(time: 1, unit: 'HOURS') 
    }

    stages {
        stage('Example') {
            steps {
                echo 'Hello World'
            }
        }
    }

    其他部分参数:
    buildDiscarder:          为最近的流水线运行的特定数量保存组件和控制台输出。
    disableConcurrentBuilds: 不允许同时执行流水线。可被用来防止同时访问共享资源等。
    overrideIndexTriggers:   允许覆盖分支索引触发器的默认处理。
    skipDefaultCheckout:     在 agent 指令中，跳过从源代码控制中检出代码的默认情况。
    skipStagesAfterUnstable: 一旦构建状态变得 UNSTABLE，跳过该阶段。
    checkoutToSubdirectory:  在工作空间的子目录中自动地执行源代码控制检出。
    timeout:    设置流水线运行的超时时间, 在此之后，Jenkins将中止流水线。
    retry:      在失败时, 重新尝试整个流水线的指定次数。
    timestamps: 预测所有由流水线生成的控制台输出，与该流水线发出的时间一致。


## parameters 参数
    
    为流水线运行时设置项目相关的参数，就不用在UI界面上定义了，比较方便。

    //string 字符串类型的参数, 例如:
    parameters { string(name: 'DEPLOY_ENV', defaultValue: 'staging', description: '') }

    //booleanParam 布尔参数, 例如:
    parameters { booleanParam(name: 'DEBUG_BUILD', defaultValue: true, description: '') }


    agent any
    parameters {
        string(name: 'PERSON', defaultValue: 'Mr Jenkins', description: 'Who should I say hello to?')
    }

    stages {
        stage('Example') {
            steps {
                echo "Hello ${params.PERSON}"
            }
        }
    }

## trigger 触发器 (构建触发器)

    // cron 计划任务定期执行构建。
    triggers { cron('H */4 * * 1-5') }

    // pollSCM 与 cron 定义类似，但是由jenkins定期检测源码变化。
    triggers { pollSCM('H */4 * * 1-5') }


    agent any
    triggers {
        cron('H */4 * * 1-5')
    }
    stages {
        stage('Example') {
            steps {
                echo 'Hello World'
            }
        }
    }


## tool 构建工具

    构建工具maven、ant、gradle 获取通过自动安装或手动放置工具的环境变量。支持 maven/jdk/gradle。工具的名称必须在"系统设置->全局工具配置"中定义。

    agent any
    tools {
        maven 'apache-maven-3.0.1' 
    }
    stages {
        stage('Example') {
            steps {
                sh 'mvn --version'
            }
        }
    }

## input 交互输入